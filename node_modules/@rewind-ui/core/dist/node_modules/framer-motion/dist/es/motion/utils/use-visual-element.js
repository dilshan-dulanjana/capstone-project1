import{useContext as t,useRef as n,useInsertionEffect as e,useEffect as o}from"react";import{PresenceContext as i}from"../../context/PresenceContext.js";import{MotionContext as r}from"../../context/MotionContext/index.js";import{useIsomorphicLayoutEffect as a}from"../../utils/use-isomorphic-effect.js";import{LazyContext as m}from"../../context/LazyContext.js";import{MotionConfigContext as c}from"../../context/MotionConfigContext.js";function s(s,p,u,f){const{visualElement:d}=t(r),x=t(m),C=t(i),l=t(c).reducedMotion,j=n();f=f||x.renderer,!j.current&&f&&(j.current=f(s,{visualState:p,parent:d,props:u,presenceContext:C,blockInitialAnimation:!!C&&!1===C.initial,reducedMotionConfig:l}));const A=j.current;e((()=>{A&&A.update(u,C)}));const S=n(Boolean(window.HandoffAppearAnimations));return a((()=>{A&&(A.render(),S.current&&A.animationState&&A.animationState.animateChanges())})),o((()=>{A&&(A.updateFeatures(),!S.current&&A.animationState&&A.animationState.animateChanges(),window.HandoffAppearAnimations=void 0,S.current=!1)})),A}export{s as useVisualElement};
