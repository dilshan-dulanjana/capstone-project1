"use strict";var e=require("./index.cjs"),t=require("./easing.cjs"),a=require("./utils/get-final-keyframe.cjs"),r=require("../js/index.cjs"),i=require("../../../utils/time-conversion.cjs"),n=require("../../../utils/memo.cjs"),s=require("../../../utils/noop.cjs"),o=require("../../../frameloop/frame.cjs");const l=n.memo((()=>Object.hasOwnProperty.call(Element.prototype,"animate"))),c=new Set(["opacity","clipPath","filter","transform","backgroundColor"]);exports.createAcceleratedAnimation=function(n,u,{onUpdate:p,onComplete:m,...d}){if(!(l()&&c.has(u)&&!d.repeatDelay&&"mirror"!==d.repeatType&&0!==d.damping&&"inertia"!==d.type))return!1;let y,f,g=!1;const h=()=>{f=new Promise((e=>{y=e}))};h();let{keyframes:j,duration:q=300,ease:T,times:v}=d;if(((e,a)=>"spring"===a.type||"backgroundColor"===e||!t.isWaapiSupportedEasing(a.ease))(u,d)){const e=r.animateValue({...d,repeat:0,delay:0});let t={done:!1,value:j[0]};const a=[];let i=0;for(;!t.done&&i<2e4;)t=e.sample(i),a.push(t.value),i+=10;v=void 0,j=a,q=i-10,T="linear"}const k=e.animateStyle(n.owner.current,u,j,{...d,duration:q,ease:T,times:v}),S=()=>k.cancel(),b=()=>{o.frame.update(S),y(),h()};return k.onfinish=()=>{n.set(a.getFinalKeyframe(j,d)),m&&m(),b()},{then:(e,t)=>f.then(e,t),attachTimeline:e=>(k.timeline=e,k.onfinish=null,s.noop),get time(){return i.millisecondsToSeconds(k.currentTime||0)},set time(e){k.currentTime=i.secondsToMilliseconds(e)},get speed(){return k.playbackRate},set speed(e){k.playbackRate=e},get duration(){return i.millisecondsToSeconds(q)},play:()=>{g||(k.play(),o.cancelFrame(S))},pause:()=>k.pause(),stop:()=>{if(g=!0,"idle"===k.playState)return;const{currentTime:e}=k;if(e){const t=r.animateValue({...d,autoplay:!1});n.setWithVelocity(t.sample(e-10).value,t.sample(e).value,10)}b()},complete:()=>k.finish(),cancel:b}};
