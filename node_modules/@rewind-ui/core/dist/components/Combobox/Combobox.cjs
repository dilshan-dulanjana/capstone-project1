'use client';
"use strict";var e=require("tslib"),o=require("react/jsx-runtime"),s=require("./combobox.reducer.cjs"),t=require("./Combobox.types.cjs"),a=require("./ComboboxGroup/ComboboxGroup.cjs"),l=require("./ComboboxOption/ComboboxOption.cjs"),i=require("./use-combobox.hook.cjs"),n=require("../FormControl/FormControl.context.cjs"),r=require("../InputGroup/InputGroup.context.cjs"),c=require("../Spinner/Spinner.cjs"),u=require("@floating-ui/react"),d=require("../../hooks/use-keypress.cjs"),p=require("../../hooks/use-vertical-arrows.hook.cjs"),b=require("../../icons/XMark.cjs"),m=require("../../theme/theme.context.cjs"),h=require("../../utils/usePropId.cjs"),g=require("react"),x=require("./Combobox.context.cjs"),j=require("../../icons/CaretUpDown.cjs");const f={clearable:!0,closeOnEscape:!0,closeOnSelect:!0,color:"dark",disabled:!1,loading:!1,maxHeight:250,minWidth:250,mode:"spacey",multiple:!1,offset:5,optionColor:"gray",radius:"lg",searchable:!0,shadow:"none",size:"md",tone:"light",validation:"none",withRing:!0},v=g.forwardRef(((a,l)=>{var v,y,C,O;const E=m.useComponentTheme("Combobox"),N=Object.assign(Object.assign(Object.assign(Object.assign({},f),n.useFormControlContext()),r.useInputGroupContext()),a),{children:q,className:R,clearable:w,closeOnEscape:I,closeOnSelect:z,color:A,controlId:k,initialValue:S,leftIcon:_,loading:P,maxHeight:W,minWidth:G,mode:F,multiple:L,offset:B,onChange:$,onSearch:H,optionColor:M,placeholder:V,radius:K,searchable:D,shadow:T,size:U,tone:X,validation:J,value:Q,withRing:Y}=N,Z=e.__rest(N,["children","className","clearable","closeOnEscape","closeOnSelect","color","controlId","initialValue","leftIcon","loading","maxHeight","minWidth","mode","multiple","offset","onChange","onSearch","optionColor","placeholder","radius","searchable","shadow","size","tone","validation","value","withRing"]),ee=h.usePropId(a.id),oe=g.useId(),se=h.usePropId(k),te=a.disabled||P,ae=!!_,le=!0,[ie,ne]=g.useReducer(s.comboboxReducer,{multiple:L||!1,initialValue:S,onChange:$,options:[],selectedOptions:[],search:"",searching:!1}),[re,ce]=g.useState([]),[ue,de]=g.useState(""),[pe,be]=g.useState(E.base({className:R,color:A,disabled:te,hasLeftIcon:ae,hasRightIcon:le,radius:K,shadow:T,size:U,tone:X,validation:J,withRing:Y})),[me,he]=g.useState(null),ge=g.useRef(null),xe=g.useRef(null),je=g.useRef(null),fe={externalSearch:!!H,mode:F,multiple:L,optionColor:M,radius:K,size:U,state:ie,dispatch:ne},{x:ve,y:ye,reference:Ce,floating:Oe,strategy:Ee,getFloatingProps:Ne,open:qe,setOpen:Re}=i.useCombobox({offset:B}),we=u.useMergeRefs([Ce,ge,l||null]),Ie=u.useMergeRefs([xe,Oe]),ze=E.wrapper({disabled:te}),Ae=E.noResults({size:U}),ke=_?E.icon({tone:X,size:U,className:_.props.className}):null,Se=E.leftIconWrapper({size:U}),_e=E.icon({tone:X,size:U}),Pe=E.rightIconWrapper({color:A,size:U});g.useEffect((()=>{ge.current&&he(ge.current.getBoundingClientRect().width)}),[]),g.useEffect((()=>{Q?L&&Array.isArray(Q)&&Q.length>0?ne({type:t.ComboboxActionEnum.init_multi_select,payload:{values:Q}}):L||"string"!=typeof Q||ne({type:t.ComboboxActionEnum.single_select,payload:{value:Q}}):ne({type:t.ComboboxActionEnum.reset,payload:null})}),[Q,L]),g.useEffect((()=>{var e;qe&&(null===(e=je.current)||void 0===e||e.focus()),Fe()}),[qe]),d.useKeypress("Escape",!0,(()=>{ne({type:t.ComboboxActionEnum.search_reset,payload:null}),qe&&I&&Re(!1)})),d.useKeypress("Backspace",qe,(()=>{ie.search||ne({type:t.ComboboxActionEnum.remove_last,payload:null})})),d.useKeypress("Enter",!0,(()=>{var e;if(!ie.searching)return;const o=null===(e=xe.current)||void 0===e?void 0:e.querySelector('button[aria-hidden="false"]:not([aria-disabled="true"])');o&&o.click()})),g.useLayoutEffect((()=>{setTimeout((()=>{xe.current&&ce(Array.from(xe.current.querySelectorAll('button[aria-hidden="false"][aria-disabled="false"]')))}),1),Fe()}),[ie.search]),g.useEffect((()=>{qe&&z&&Re(!1)}),[ie.selectedOptions]),p.useVerticalArrows(re,qe);const We=o.jsx("div",Object.assign({className:pe},{children:o.jsxs("div",Object.assign({className:E.tagWrapper({size:U})},{children:[L&&(null===(v=ie.selectedOptions)||void 0===v?void 0:v.map(((e,s)=>o.jsxs("div",Object.assign({className:E.tag({disabled:te,radius:K,size:U,tone:X})},{children:[o.jsx("button",Object.assign({type:"button",disabled:te,"aria-label":`Remove ${e.label}`,className:E.tagButton({color:A,disabled:te}),onClick:o=>{ne({type:t.ComboboxActionEnum.multi_select,payload:{value:e.value,toggle:!0}}),o.stopPropagation()}},{children:o.jsx("span",Object.assign({className:E.tagButtonIcon()},{children:"âœ•"}))})),o.jsx("span",{children:e.label})]}),`label-${s}`)))),(!L||qe||0===ie.selectedOptions.length)&&o.jsx("input",{id:se,ref:je,disabled:te,className:E.input({size:U}),role:"combobox","aria-controls":oe,"aria-autocomplete":D?"both":"list","aria-haspopup":"listbox","aria-expanded":qe,value:ie.searching?ie.search:(L?"":null===(y=ie.selectedOptions[0])||void 0===y?void 0:y.label)||"",placeholder:ie.selectedOptions.length?"":V,readOnly:!D,autoComplete:"off",onBlur:()=>ne({type:t.ComboboxActionEnum.search_reset,payload:null}),onChange:e=>{ne({type:t.ComboboxActionEnum.search_start,payload:{search:e.target.value}}),H&&H(e.target.value),qe||Re(!0)},type:"text"})]}))})),Ge="solid"===X?"slate":"gray",Fe=()=>{xe.current&&de(E.list({size:U,open:qe,mode:F,radius:K,shadow:T}))};return g.useEffect((()=>{var e,o;if(!(null===(e=ge.current)||void 0===e?void 0:e.dataset))return;const s=Object.assign({},null===(o=ge.current)||void 0===o?void 0:o.dataset),t=s.hasOwnProperty("hasLeftElement")&&"true"===s.hasLeftElement,a=s.hasOwnProperty("hasRightElement")&&"true"===s.hasRightElement;be(E.base({className:R,color:A,disabled:te,hasLeftElement:t,hasLeftIcon:ae,hasRightElement:a,hasRightIcon:le,radius:K,shadow:T,size:U,tone:X,validation:J,withRing:Y}))}),[R,A,te,ae,le,K,T,U,E,X,J,Y]),o.jsx(o.Fragment,{children:o.jsxs("div",Object.assign({id:ee,ref:we,className:ze,onClick:()=>{var e;qe||te||Re(!0),null===(e=null==je?void 0:je.current)||void 0===e||e.focus()}},Z,{children:[_&&o.jsx("span",Object.assign({className:Se},{children:g.cloneElement(_,{className:ke})})),We,P&&o.jsx("span",Object.assign({className:Pe},{children:o.jsx(c,{size:U,color:Ge})})),!P&&w&&(null===(C=ie.selectedOptions)||void 0===C?void 0:C.length)>0&&o.jsx("button",Object.assign({"aria-label":"Clear",type:"button",disabled:te,onClick:e=>{ne({type:t.ComboboxActionEnum.reset,payload:null}),ne({type:t.ComboboxActionEnum.search_reset,payload:null}),e.stopPropagation()},className:Pe},{children:o.jsx(b.XMarkIcon,{className:_e})})),!P&&(!w||0===(null===(O=ie.selectedOptions)||void 0===O?void 0:O.length))&&o.jsx("div",Object.assign({className:Pe},{children:o.jsx(j.CaretUpDown,{className:_e})})),o.jsx(x.ComboboxContextProvider,Object.assign({value:fe},{children:o.jsx(u.FloatingPortal,{children:o.jsxs("div",Object.assign({id:oe,role:"listbox",ref:Ie,className:ue,style:{display:qe?"block":"none",opacity:qe&&!te?1:0,maxHeight:`${W}px`,minWidth:`${G}px`,maxWidth:`${me}px`,position:Ee,top:ye&&ye>0&&ye!==1/0?ye:0,left:ve||0}},Ne,{children:[0===(null==re?void 0:re.length)&&ie.searching&&o.jsx("div",Object.assign({className:Ae},{children:"No results"})),q]}))})}))]}))})}));v.displayName="Combobox";const y=Object.assign(v,{Group:a.ComboboxGroup,Option:l.ComboboxOption});module.exports=y;
